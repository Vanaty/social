<!--
=========================================================
* Soft UI Dashboard Tailwind - v1.0.5
=========================================================

* Product Page: https://www.creative-tim.com/product/soft-ui-dashboard-tailwind
* Copyright 2023 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">

<head th:replace="~{include/head :: head}">
</head>

<body class="m-0 font-sans antialiased font-normal bg-white text-start text-base leading-default text-slate-500">
  <!-- Navbar -->

  <main class="mt-0 transition-all duration-200 ease-soft-in-out">
    <section class="min-h-screen mb-32">
      <div
        class="relative flex items-start pt-12 pb-56 m-4 overflow-hidden bg-center bg-cover min-h-50-screen rounded-xl"
        style="
            background-image: url('../assets/img/curved-images/curved14.jpg');
          ">
        <span
          class="absolute top-0 left-0 w-full h-full bg-center bg-cover bg-gradient-to-tl from-gray-900 to-slate-800 opacity-60"></span>
        <div class="container z-10">
          <div class="flex flex-wrap justify-center -mx-3">
            <div class="w-full max-w-full px-3 mx-auto mt-0 text-center lg:flex-0 shrink-0 lg:w-5/12">
              <h1 class="mt-12 mb-2 text-white">Welcome!</h1>
              <p class="text-white">
                Please fill in the form below to create your account.
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="flex flex-wrap -mx-3 -mt-48 md:-mt-56 lg:-mt-48">
          <div class="w-full max-w-full px-3 mx-auto mt-0 md:flex-0 shrink-0 md:w-7/12 lg:w-5/12 xl:w-4/12">
            <div
              class="relative z-0 flex flex-col min-w-0 break-words bg-white border-0 shadow-soft-xl rounded-2xl bg-clip-border">
              <div class="flex-auto p-6">
                <form role="form text-left" id="sign-up-form">
                  <label class="mb-2 ml-1 font-bold text-xs text-slate-700">Username</label>
                  <div class="mb-4 relative">
                    <input type="text" id="username-input"
                      class="text-sm focus:shadow-soft-primary-outline leading-5.6 ease-soft block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding py-2 px-3 font-normal text-gray-700 transition-all focus:border-fuchsia-300 focus:bg-white focus:text-gray-700 focus:outline-none focus:transition-shadow"
                      placeholder="Username" aria-label="Username" aria-describedby="username-addon" name="username"/>
                    <div id="username-status" class="absolute right-3 top-2 text-sm">
                      <i id="username-loading" class="fas fa-spinner fa-spin text-gray-400 hidden"></i>
                      <i id="username-available" class="fas fa-check text-green-500 hidden"></i>
                      <i id="username-taken" class="fas fa-times text-red-500 hidden"></i>
                    </div>
                    <div id="username-message" class="mt-1 text-xs hidden"></div>
                  </div>

                  <label class="mb-2 ml-1 font-bold text-xs text-slate-700">Email</label>
                  <div class="mb-4">
                    <input type="email"
                      class="text-sm focus:shadow-soft-primary-outline leading-5.6 ease-soft block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding py-2 px-3 font-normal text-gray-700 transition-all focus:border-fuchsia-300 focus:bg-white focus:text-gray-700 focus:outline-none focus:transition-shadow"
                      placeholder="Email" aria-label="Email" aria-describedby="email-addon" name="email"/>
                  </div>

                  <label class="mb-2 ml-1 font-bold text-xs text-slate-700">First Name</label>
                  <div class="mb-4">
                    <input type="text"
                      class="text-sm focus:shadow-soft-primary-outline leading-5.6 ease-soft block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding py-2 px-3 font-normal text-gray-700 transition-all focus:border-fuchsia-300 focus:bg-white focus:text-gray-700 focus:outline-none focus:transition-shadow"
                      placeholder="First Name" aria-label="First Name" aria-describedby="first-name-addon" name="firstName"/>
                  </div>

                  <label class="mb-2 ml-1 font-bold text-xs text-slate-700">Last Name</label>
                  <div class="mb-4">
                    <input type="text"
                      class="text-sm focus:shadow-soft-primary-outline leading-5.6 ease-soft block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding py-2 px-3 font-normal text-gray-700 transition-all focus:border-fuchsia-300 focus:bg-white focus:text-gray-700 focus:outline-none focus:transition-shadow"
                      placeholder="Last Name" aria-label="Last Name" aria-describedby="last-name-addon" name="lastName"/>
                  </div>
                  <label class="mb-2 ml-1 font-bold text-xs text-slate-700">Password</label>
                  <div class="mb-4 relative">
                    <input type="password" id="password-input"
                      class="text-sm focus:shadow-soft-primary-outline leading-5.6 ease-soft block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding py-2 px-3 pr-10 font-normal text-gray-700 transition-all focus:border-fuchsia-300 focus:bg-white focus:text-gray-700 focus:outline-none focus:transition-shadow"
                      placeholder="Password" aria-label="Password" aria-describedby="password-addon" name="password"/>
                    <button type="button" id="toggle-password" class="absolute right-3 top-2 text-gray-400 hover:text-gray-600">
                      <i id="show-password" class="fas fa-eye"></i>
                      <i id="hide-password" class="fas fa-eye-slash hidden"></i>
                    </button>
                  </div>

                  <label class="mb-2 ml-1 font-bold text-xs text-slate-700">Confirm Password</label>
                  <div class="mb-4 relative">
                    <input type="password" id="confirm-password-input"
                      class="text-sm focus:shadow-soft-primary-outline leading-5.6 ease-soft block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding py-2 px-3 pr-10 font-normal text-gray-700 transition-all focus:border-fuchsia-300 focus:bg-white focus:text-gray-700 focus:outline-none focus:transition-shadow"
                      placeholder="Confirm Password" aria-label="Confirm Password" aria-describedby="confirm-password-addon" name="confirmPassword"/>
                    <button type="button" id="toggle-confirm-password" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600"></button>
                      <i id="show-confirm-password" class="fas fa-eye"></i>
                      <i id="hide-confirm-password" class="fas fa-eye-slash hidden"></i>
                    </button>
                    <div id="password-message" class="mt-1 text-xs hidden"></div>
                  </div>
                  <div class="min-h-6 pl-6.92 mb-0.5 block">
                    <input id="terms"
                      class="w-4.92 h-4.92 ease-soft -ml-6.92 rounded-1.4 checked:bg-gradient-to-tl checked:from-gray-900 checked:to-slate-800 after:text-xxs after:font-awesome after:duration-250 after:ease-soft-in-out duration-250 relative float-left mt-1 cursor-pointer appearance-none border border-solid border-slate-200 bg-white bg-contain bg-center bg-no-repeat align-top transition-all after:absolute after:flex after:h-full after:w-full after:items-center after:justify-center after:text-white after:opacity-0 after:transition-all after:content-['\f00c'] checked:border-0 checked:border-transparent checked:bg-transparent checked:after:opacity-100"
                      type="checkbox" value="" checked />
                    <label class="mb-2 ml-1 font-normal cursor-pointer select-none text-sm text-slate-700" for="terms">
                      I agree the
                      <a href="javascript:;" class="font-bold text-slate-700">Terms and Conditions</a>
                    </label>
                  </div>
                  <div class="text-center">
                    <button type="submit"
                      class="inline-block w-full px-6 py-3 mt-6 mb-2 font-bold text-center text-white uppercase align-middle transition-all bg-transparent border-0 rounded-lg cursor-pointer active:opacity-85 hover:scale-102 hover:shadow-soft-xs leading-pro text-xs ease-soft-in tracking-tight-soft shadow-soft-md bg-150 bg-x-25 bg-gradient-to-tl from-gray-900 to-slate-800 hover:border-slate-700 hover:bg-slate-700 hover:text-white">
                      Sign up
                    </button>
                  </div>
                  <p class="mt-4 mb-0 leading-normal text-sm">
                    Already have an account?
                    <a href="/sign-in" class="font-bold text-slate-700">Sign in</a>
                  </p>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- -------- START FOOTER 3 w/ COMPANY DESCRIPTION WITH LINKS & SOCIAL ICONS & COPYRIGHT ------- -->
    <footer th:replace="~{include/footer-auth :: footer}">

    </footer>
    <!-- -------- END FOOTER 3 w/ COMPANY DESCRIPTION WITH LINKS & SOCIAL ICONS & COPYRIGHT ------- -->
  </main>
</body>
<script type="text/javascript">
  let usernameCheckTimeout;
  let isUsernameAvailable = false;
  let passwordsMatch = false;

  // Password visibility toggle
  document.getElementById('toggle-password').addEventListener('click', function() {
    const passwordInput = document.getElementById('password-input');
    const showIcon = document.getElementById('show-password');
    const hideIcon = document.getElementById('hide-password');
    
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      showIcon.classList.add('hidden');
      hideIcon.classList.remove('hidden');
    } else {
      passwordInput.type = 'password';
      showIcon.classList.remove('hidden');
      hideIcon.classList.add('hidden');
    }
  });

  document.getElementById('toggle-confirm-password').addEventListener('click', function() {
    const confirmPasswordInput = document.getElementById('confirm-password-input');
    const showIcon = document.getElementById('show-confirm-password');
    const hideIcon = document.getElementById('hide-confirm-password');
    
    if (confirmPasswordInput.type === 'password') {
      confirmPasswordInput.type = 'text';
      showIcon.classList.add('hidden');
      hideIcon.classList.remove('hidden');
    } else {
      confirmPasswordInput.type = 'password';
      showIcon.classList.remove('hidden');
      hideIcon.classList.add('hidden');
    }
  });

  // Password confirmation validation
  function validatePasswords() {
    const password = document.getElementById('password-input').value;
    const confirmPassword = document.getElementById('confirm-password-input').value;
    const confirmPasswordInput = document.getElementById('confirm-password-input');
    const messageDiv = document.getElementById('password-message');

    if (confirmPassword === '') {
      messageDiv.classList.add('hidden');
      confirmPasswordInput.classList.remove('border-green-500', 'border-red-500');
      confirmPasswordInput.classList.add('border-gray-300');
      passwordsMatch = false;
      return;
    }

    if (password === confirmPassword) {
      messageDiv.textContent = 'Passwords match';
      messageDiv.className = 'mt-1 text-xs text-green-600';
      messageDiv.classList.remove('hidden');
      confirmPasswordInput.classList.remove('border-gray-300', 'border-red-500');
      confirmPasswordInput.classList.add('border-green-500');
      passwordsMatch = true;
    } else {
      messageDiv.textContent = 'Passwords do not match';
      messageDiv.className = 'mt-1 text-xs text-red-600';
      messageDiv.classList.remove('hidden');
      confirmPasswordInput.classList.remove('border-gray-300', 'border-green-500');
      confirmPasswordInput.classList.add('border-red-500');
      passwordsMatch = false;
    }
  }

  document.getElementById('password-input').addEventListener('input', validatePasswords);
  document.getElementById('confirm-password-input').addEventListener('input', validatePasswords);

  // Username availability check
  document.getElementById('username-input').addEventListener('input', function(e) {
    const username = e.target.value.trim();
    const usernameInput = e.target;
    const loadingIcon = document.getElementById('username-loading');
    const availableIcon = document.getElementById('username-available');
    const takenIcon = document.getElementById('username-taken');
    const messageDiv = document.getElementById('username-message');

    // Reset icons and input styling
    loadingIcon.classList.add('hidden');
    availableIcon.classList.add('hidden');
    takenIcon.classList.add('hidden');
    messageDiv.classList.add('hidden');
    usernameInput.classList.remove('border-green-500', 'border-red-500');
    usernameInput.classList.add('border-gray-300');

    if (username.length < 3) {
      isUsernameAvailable = false;
      return;
    }

    // Clear previous timeout
    clearTimeout(usernameCheckTimeout);

    // Show loading
    loadingIcon.classList.remove('hidden');

    // Debounce the API call
    usernameCheckTimeout = setTimeout(() => {
      fetch(`/api/auth/check-username?username=${encodeURIComponent(username)}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        loadingIcon.classList.add('hidden');
        if (data.available) {
          availableIcon.classList.remove('hidden');
          messageDiv.textContent = 'Username is available';
          messageDiv.className = 'mt-1 text-xs text-green-600';
          messageDiv.classList.remove('hidden');
          // Add green border
          usernameInput.classList.remove('border-gray-300', 'border-red-500');
          usernameInput.classList.add('border-green-500');
          isUsernameAvailable = true;
        } else {
          takenIcon.classList.remove('hidden');
          messageDiv.textContent = 'Username is already taken';
          messageDiv.className = 'mt-1 text-xs text-red-600';
          messageDiv.classList.remove('hidden');
          // Add red border
          usernameInput.classList.remove('border-gray-300', 'border-green-500');
          usernameInput.classList.add('border-red-500');
          isUsernameAvailable = false;
        }
      })
      .catch(error => {
        console.error('Error checking username:', error);
        loadingIcon.classList.add('hidden');
        messageDiv.textContent = 'Error checking username availability';
        messageDiv.className = 'mt-1 text-xs text-red-600';
        messageDiv.classList.remove('hidden');
        // Add red border for error
        usernameInput.classList.remove('border-gray-300', 'border-green-500');
        usernameInput.classList.add('border-red-500');
        isUsernameAvailable = false;
      });
    }, 500);
  });

  document.getElementById('sign-up-form').addEventListener('submit', function (e) {
    e.preventDefault();

    // Check if username is available
    if (!isUsernameAvailable) {
      const messageDiv = document.getElementById('username-message');
      messageDiv.textContent = 'Please choose an available username';
      messageDiv.className = 'mt-1 text-xs text-red-600';
      messageDiv.classList.remove('hidden');
      return;
    }

    // Check if passwords match
    if (!passwordsMatch) {
      const messageDiv = document.getElementById('password-message');
      messageDiv.textContent = 'Passwords must match';
      messageDiv.className = 'mt-1 text-xs text-red-600';
      messageDiv.classList.remove('hidden');
      return;
    }

    const form = document.getElementById('sign-up-form');
    const formData = new FormData(form);
    var object = {};
    formData.forEach(function(value, key){
        object[key] = value;
    });
    var json = JSON.stringify(object);
    console.log(json);
    
    fetch('/api/auth/register', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: json
    })
      .then(response => {
        if (!response.ok) {
          return response.text().then(text => { throw new Error(text) });
        }
        return response.text();
      })
      .then(data => {
        // Success handling
        setTimeout(() => {
          window.location.href = '/sign-in';
        }, 2000);
      })
      .catch(error => {
        console.error('Error:', error);
        // Error handling
      });
  });
</script>
<!-- plugin for scrollbar  -->
<script src="../assets/js/plugins/perfect-scrollbar.min.js" async></script>
<!-- main script file  -->
<script src="../assets/js/soft-ui-dashboard-tailwind.js?v=1.0.5" async></script>

</html>